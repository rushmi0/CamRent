-- [ People Table ]
CREATE TABLE IF NOT EXISTS People
(
    PersonID    TEXT PRIMARY KEY,
    FirstName   TEXT                                                       NOT NULL,
    LastName    TEXT                                                       NOT NULL,
    Email       TEXT CHECK (Email LIKE '%_@__%.__%' OR Email LIKE '%@%.%') NOT NULL,
    PhoneNumber TEXT                                                       NOT NULL,
    AddressID   TEXT,
    FOREIGN KEY (AddressID) REFERENCES Address (AddressID)
);

-- [ Customers Table ]
CREATE TABLE IF NOT EXISTS Customers
(
    CustomerID   TEXT PRIMARY KEY,
    UserName     TEXT        NOT NULL UNIQUE,
    ProfileImage BLOB,
    AuthKey      TEXT        NOT NULL,
    PersonID     TEXT UNIQUE NOT NULL,
    FOREIGN KEY (PersonID) REFERENCES People (PersonID)
);

-- [ Stores Table ]
CREATE TABLE IF NOT EXISTS Stores
(
    StoreID       TEXT PRIMARY KEY,
    StoreName     TEXT        NOT NULL UNIQUE,
    ProfileImage  BLOB,
    PaymentMethod TEXT,
    AuthKey       TEXT,
    PersonID      TEXT UNIQUE NOT NULL,
    FOREIGN KEY (PersonID) REFERENCES People (PersonID)
);

-- [ Address Table ]
CREATE TABLE IF NOT EXISTS Address
(
    AddressID    TEXT PRIMARY KEY,
    LocationName TEXT NOT NULL,
    City         TEXT NOT NULL,
    Province     TEXT NOT NULL,
    PostalNumber TEXT NOT NULL,
    StreetName   TEXT NOT NULL
);

-- [ CreditScore Table ]
CREATE TABLE IF NOT EXISTS CreditScore
(
    ScoreID    TEXT PRIMARY KEY,
    Score      INTEGER DEFAULT 0,
    Report     TEXT,
    StoreID    TEXT,
    CustomerID TEXT,
    FOREIGN KEY (StoreID) REFERENCES Stores (StoreID),
    FOREIGN KEY (CustomerID) REFERENCES Customers (CustomerID)
);

-- [ OrderContract Table ]
CREATE TABLE IF NOT EXISTS OrderContract
(
    OrderID    TEXT PRIMARY KEY,
    Quantity   INTEGER DEFAULT 0,
    Duration   INTEGER DEFAULT 0,
    CustomerID TEXT,
    AddressID  TEXT,
    ProductID  TEXT,
    FOREIGN KEY (ProductID) REFERENCES Products (ProductID),
    FOREIGN KEY (CustomerID) REFERENCES Customers (CustomerID),
    FOREIGN KEY (AddressID) REFERENCES Address (AddressID)
);

-- [ Transactions Table ]
CREATE TABLE IF NOT EXISTS Transactions
(
    TxID       TEXT PRIMARY KEY,
    TotalPrice INTEGER NOT NULL,
    Status     TEXT     DEFAULT 'Pending', -- 'Pending'  / 'Confirmed'
    TimeSpam   DATETIME DEFAULT (strftime('%H:%M:%S', 'now')),
    Date       DATETIME DEFAULT (strftime('%d-%m-%Y', 'now')),
    OrderID    TEXT,
    FOREIGN KEY (OrderID) REFERENCES OrderContract (OrderID)
);

-- [ Products Table ]
CREATE TABLE IF NOT EXISTS Products
(
    ProductID     TEXT PRIMARY KEY,
    ProductName   TEXT NOT NULL,
    Image1        BLOB,
    Image2        BLOB,
    Image3        BLOB,
    Image4        BLOB,
    Type          TEXT    DEFAULT 'N/A',
    Price         INTEGER DEFAULT 0,
    SpecDetail    TEXT, -- JSON
    DESC          TEXT,
    ProductStatus TEXT    DEFAULT ' Unavailable',
    StoreID       TEXT,
    FOREIGN KEY (StoreID) REFERENCES Stores (StoreID)
);

-- [ FineTable ]
CREATE TABLE IF NOT EXISTS Fine
(
    FineID      TEXT PRIMARY KEY,
    TimeSpam    DATETIME DEFAULT (strftime('%H:%M:%S', 'now')),
    Date        DATETIME DEFAULT (strftime('%d-%m-%Y', 'now')),
    Description TEXT,
    Image1      BLOB NOT NULL,
    Image2      BLOB NOT NULL,
    Image3      BLOB NOT NULL,
    Image4      BLOB,
    PenaltyFee  INTEGER,
    Status      TEXT NOT NULL,
    StoreID     TEXT,
    ProductID   TEXT,
    CustomerID  TEXT,
    FOREIGN KEY (CustomerID) REFERENCES Customers (CustomerID),
    FOREIGN KEY (StoreID) REFERENCES Stores (StoreID),
    FOREIGN KEY (ProductID) REFERENCES Products (ProductID)
);



SELECT name
FROM sqlite_master
WHERE type = 'table';





-- [ คำสั่งลบตาราง ]
DROP TABLE IF EXISTS People;

DROP TABLE IF EXISTS Customers;

DROP TABLE IF EXISTS Stores;

DROP TABLE IF EXISTS Address;

DROP TABLE IF EXISTS CreditScore;

DROP TABLE IF EXISTS OrderContract;

DROP TABLE IF EXISTS Transactions;

DROP TABLE IF EXISTS Products;

DROP TABLE IF EXISTS Fine;
